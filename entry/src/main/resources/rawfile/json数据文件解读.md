# 星禽研习 - JSON数据文件解读

## 项目概述

**星禽研习** 是一款基于传统演禽术（二十八宿体系）的国学研习工具。本项目将演禽术的核心算法（年禽、月禽、日禽、时禽）和断语规则完全数据化，以 JSON 配置驱动，便于后续扩展至**演禽盘式**和**禽星锁泊十二宫**等高级功能。

---

## 项目结构

```
CelestialBeastsAuspiciousTiming/
├── AppScope/                                # 应用级配置
│   ├── resources/base/
│   │   ├── element/string.json              # 应用名称：星禽研习
│   │   └── media/layered_image.json         # 应用图标配置
│   └── app.json5
├── entry/
│   └── src/main/
│       ├── ets/pages/Index.ets              # 主页面（排盘UI与算法）
│       └── resources/rawfile/               # 核心数据文件
│           ├── calendar/                    # 万年历数据（17个JSON）
│           ├── yanqin_star_rules.json       # ⭐ 四禽计算规则（核心）
│           ├── lost_items_config.json       # 用神配置（象类→星宿映射）
│           ├── lost_items_rules.json        # 断语规则库（132条）
│           └── yanqin_meta_config.json      # 元配置（汇总）
├── 规则/                                     # 演禽术原始规则文档
│   ├── 2. 起年禽诀.md
│   ├── 3. 起月禽诀.md
│   ├── 4. 起日禽诀.md
│   ├── 5. 起时禽诀.md
│   └── ...
└── hvigor/                                   # 构建配置
```

---

## JSON 文件总览

| 文件名 | 用途 | 条目数 |
|--------|------|--------|
| `yanqin_star_rules.json` | 四禽（年/月/日/时禽）计算规则 | - |
| `lost_items_config.json` | 用神配置（13种象类→星宿映射） | 13条 |
| `lost_items_rules.json` | 断语规则库（星宿在地支） | 132条 |
| `calendar/*.json` | 万年历数据（1900-2061） | 17个文件 |

---

## 1. 万年历数据 `calendar/`

### 数据范围
- **时间跨度**：1900年 - 2061年（162年）
- **文件数量**：17个JSON文件
- **存储路径**：`entry/src/main/resources/rawfile/calendar/`
- **单文件大小**：约 1.6MB（最后一个文件约 167KB，仅含2年数据）

### 文件命名规则
| 文件名 | 年份范围 |
|--------|----------|
| calendar_data_0001.json | 1900-1909 |
| calendar_data_0002.json | 1910-1919 |
| ... | ... |
| calendar_data_0017.json | 2060-2061 |

### 文件选择逻辑

根据用户输入的公历年份，计算对应的文件编号：

```typescript
function getFileIndex(year: number): string {
  const index = Math.floor((year - 1900) / 10) + 1;
  return index.toString().padStart(4, '0');
}
```

### 数据结构

每条记录代表一天的完整信息：

```json
{
  "date": "2060-02-04",
  "year": 2060,
  "month": 2,
  "day": 4,
  "lunar_year": 2060,
  "lunar_month": 1,
  "lunar_day": 3,
  "zodiac": "龙",
  "year_gan": "庚",
  "year_zhi": "辰",
  "month_gan": "戊",
  "month_zhi": "寅",
  "day_gan": "丁",
  "day_zhi": "未",
  "week_day": 2,
  "week_name": "星期三",
  "is_holiday": 0,
  "holiday_name": "",
  "solar_term": "立春",
  "festivals": ""
}
```

### 字段说明

| 字段 | 类型 | 说明 | 演禽用途 |
|------|------|------|----------|
| `date` | string | 公历日期 | 用户输入 |
| `year_gan` | string | 年干 | 配合年禽计算 |
| `year_zhi` | string | 年支 | 配合年禽计算 |
| `day_gan` | string | 日干 | **关键**：用于判断甲子日 |
| `day_zhi` | string | 日支 | **关键**：配合日禽计算 |
| `lunar_month` | number | 农历月 | 配合月禽计算 |

---

## 2. 四禽计算规则 `yanqin_star_rules.json` ⭐核心

此文件是演禽术算法的**核心配置**，包含年禽、月禽、日禽、时禽的完整计算规则，为后续**演禽盘式**和**禽星锁泊十二宫**打下基础。

### 2.1 二十八宿基础数据

```json
"constellations_order": [
  "角", "亢", "氐", "房", "心", "尾", "箕",
  "斗", "牛", "女", "虚", "危", "室", "壁",
  "奎", "娄", "胃", "昴", "毕", "觜", "参",
  "井", "鬼", "柳", "星", "张", "翼", "轸"
]
```

**星宿详情**（共28宿）：

| 星宿 | 全名 | 七政属性 | 禽名 |
|------|------|----------|------|
| 角 | 角木蛟 | 木 | 蛟 |
| 亢 | 亢金龙 | 金 | 龙 |
| 氐 | 氐土貉 | 土 | 貉 |
| 房 | 房日兔 | 日 | 兔 |
| 心 | 心月狐 | 月 | 狐 |
| 尾 | 尾火虎 | 火 | 虎 |
| 箕 | 箕水豹 | 水 | 豹 |
| 斗 | 斗木獬 | 木 | 獬 |
| 牛 | 牛金牛 | 金 | 牛 |
| 女 | 女土蝠 | 土 | 蝠 |
| 虚 | 虚日鼠 | 日 | 鼠 |
| 危 | 危月燕 | 月 | 燕 |
| 室 | 室火猪 | 火 | 猪 |
| 壁 | 壁水貐 | 水 | 貐 |
| 奎 | 奎木狼 | 木 | 狼 |
| 娄 | 娄金狗 | 金 | 狗 |
| 胃 | 胃土雉 | 土 | 雉 |
| 昴 | 昴日鸡 | 日 | 鸡 |
| 毕 | 毕月乌 | 月 | 乌 |
| 觜 | 觜火猴 | 火 | 猴 |
| 参 | 参水猿 | 水 | 猿 |
| 井 | 井木犴 | 木 | 犴 |
| 鬼 | 鬼金羊 | 金 | 羊 |
| 柳 | 柳土獐 | 土 | 獐 |
| 星 | 星日马 | 日 | 马 |
| 张 | 张月鹿 | 月 | 鹿 |
| 翼 | 翼火蛇 | 火 | 蛇 |
| 轸 | 轸水蚓 | 水 | 蚓 |

### 2.2 年禽计算规则

**口诀来源**：《起年禽诀》

```json
"year_star_rules": {
  "base_year": 1984,
  "base_star": "虚",
  "note": "1984年甲子年，年禽为虚日鼠"
}
```

**算法**：
```typescript
// 年禽计算
const yearDiff = targetYear - 1984;
const starIndex = ((yearDiff % 28) + 28) % 28; // 处理负数
const yearStar = constellations_order[(10 + starIndex) % 28]; // 10是"虚"的索引
```

### 2.3 月禽计算规则

**口诀**："太阳用角木参头，太阴起室火星取，金心土胃水骑牛"

```json
"month_star_rules": {
  "element_to_start_star": {
    "日": "角",  // 太阳值年，正月起角
    "月": "室",  // 太阴值年，正月起室
    "火": "室",  // 火星值年，正月起室
    "金": "心",  // 金星值年，正月起心
    "土": "胃",  // 土星值年，正月起胃
    "水": "牛",  // 水星值年，正月起牛
    "木": "参"   // 木星值年，正月起参
  }
}
```

**算法**：
1. 计算当年年禽
2. 查年禽的七政属性（日/月/火/水/木/金/土）
3. 根据属性查正月起始星宿
4. 从起始星宿顺数到目标月

### 2.4 日禽计算规则（七元甲子）⭐最复杂

**口诀**："七元禽星会者稀，虚奎毕鬼翼氐箕"

这是演禽术的**核心算法**，基于"七元甲子"体系：
- **420天** 为一大循环（7元 × 60天）
- **60天** 为一元
- **15天** 为一将

```json
"day_star_rules": {
  "cycle_days": 420,
  "yuan_days": 60,
  "jiang_days": 15,
  
  "seven_yuan_heads": {
    "list": ["虚", "奎", "毕", "鬼", "翼", "氐", "箕"]
  },

  "four_generals": {
    "一元": ["虚", "张", "室", "轸"],
    "二元": ["奎", "亢", "胃", "房"],
    "三元": ["毕", "尾", "参", "斗"],
    "四元": ["鬼", "女", "星", "危"],
    "五元": ["翼", "壁", "角", "娄"],
    "六元": ["氐", "昴", "心", "觜"],
    "七元": ["箕", "井", "牛", "柳"]
  },

  "base_date": {
    "date": "1984-02-02",
    "yuan": 1,
    "jiang": 1,
    "star": "虚",
    "note": "1984年2月2日为一元甲子日，起虚日鼠"
  }
}
```

**算法**：
```typescript
// 日禽计算
const baseDate = new Date('1984-02-02');
const targetDate = new Date(dateString);
const diffDays = Math.floor((targetDate.getTime() - baseDate.getTime()) / (1000 * 60 * 60 * 24));

// 在420天大循环中的位置
const posInCycle = ((diffDays % 420) + 420) % 420;

// 确定第几元（0-6）
const yuanIndex = Math.floor(posInCycle / 60);

// 确定第几将（0-3）
const posInYuan = posInCycle % 60;
const jiangIndex = Math.floor(posInYuan / 15);

// 确定在该将内的第几天（0-14）
const dayInJiang = posInYuan % 15;

// 获取该将的起始星宿
const yuanNames = ["一元", "二元", "三元", "四元", "五元", "六元", "七元"];
const jiangStar = four_generals[yuanNames[yuanIndex]][jiangIndex];

// 从起始星宿顺数
const jiangStarIndex = constellations_order.indexOf(jiangStar);
const dayStarIndex = (jiangStarIndex + dayInJiang) % 28;
const dayStar = constellations_order[dayStarIndex];
```

### 2.5 时禽计算规则

**口诀**："日虚月鬼火寻箕，水毕木氐金奎位，土翼还从子位推"

```json
"hour_star_rules": {
  "element_to_start_star": {
    "日": "虚",  // 日属性的日子，子时起虚
    "月": "鬼",  // 月属性的日子，子时起鬼
    "火": "箕",  // 火属性的日子，子时起箕
    "水": "毕",  // 水属性的日子，子时起毕
    "木": "氐",  // 木属性的日子，子时起氐
    "金": "奎",  // 金属性的日子，子时起奎
    "土": "翼"   // 土属性的日子，子时起翼
  }
}
```

**算法**：
1. 计算当天日禽
2. 查日禽的七政属性
3. 根据属性查子时起始星宿
4. 从子时起始宿顺数到目标时辰

### 2.6 时辰对照表

```json
"hour_time_ranges": {
  "子": { "start": "23:00", "end": "01:00", "index": 0 },
  "丑": { "start": "01:00", "end": "03:00", "index": 1 },
  "寅": { "start": "03:00", "end": "05:00", "index": 2 },
  "卯": { "start": "05:00", "end": "07:00", "index": 3 },
  "辰": { "start": "07:00", "end": "09:00", "index": 4 },
  "巳": { "start": "09:00", "end": "11:00", "index": 5 },
  "午": { "start": "11:00", "end": "13:00", "index": 6 },
  "未": { "start": "13:00", "end": "15:00", "index": 7 },
  "申": { "start": "15:00", "end": "17:00", "index": 8 },
  "酉": { "start": "17:00", "end": "19:00", "index": 9 },
  "戌": { "start": "19:00", "end": "21:00", "index": 10 },
  "亥": { "start": "21:00", "end": "23:00", "index": 11 }
}
```

---

## 3. 用神配置 `lost_items_config.json`

**来源**：《鬼谷子二十八宿演禽走失全书歌》

用于映射"象类"（走失对象）到对应的"用神"（星宿）：

```json
"use_gods": [
  { "category": "男子", "star": "觜", "note": "男寻觜宿" },
  { "category": "女子", "star": "奎", "note": "妇寻奎" },
  { "category": "小儿/男孩", "star": "虚", "note": "小儿寻虚" },
  { "category": "小女/女孩", "star": "女", "note": "女寻蝠" },
  { "category": "牛", "star": "牛", "note": "牛寻牛星" },
  { "category": "马", "star": "星", "note": "马寻马" },
  { "category": "羊", "star": "鬼", "note": "羊寻羊兮" },
  { "category": "猪", "star": "室", "note": "猪寻猪" },
  { "category": "驴/骡", "star": "房", "note": "走失驴骡寻房宿" },
  { "category": "金银财宝", "star": "参", "note": "金银财宝是寻参" },
  { "category": "鸡", "star": "昴", "note": "失鸡寻昴" },
  { "category": "狗", "star": "娄", "note": "狗寻娄" },
  { "category": "衣服", "star": "柳", "note": "衣服寻柳定是真" }
]
```

### 用神对照表

| 象类（走失对象） | 用神（星宿） | 口诀 |
|------------------|--------------|------|
| 男子 | 觜（火猴） | 男寻觜宿 |
| 女子 | 奎（木狼） | 妇寻奎 |
| 小儿/男孩 | 虚（日鼠） | 小儿寻虚 |
| 小女/女孩 | 女（土蝠） | 女寻蝠 |
| 牛 | 牛（金牛） | 牛寻牛星 |
| 马 | 星（日马） | 马寻马 |
| 羊 | 鬼（金羊） | 羊寻羊兮 |
| 猪 | 室（火猪） | 猪寻猪 |
| 驴/骡 | 房（日兔） | 走失驴骡寻房宿 |
| 金银财宝 | 参（水猿） | 金银财宝是寻参 |
| 鸡 | 昴（日鸡） | 失鸡寻昴 |
| 狗 | 娄（金狗） | 狗寻娄 |
| 衣服 | 柳（土獐） | 衣服寻柳定是真 |

---

## 4. 断语规则库 `lost_items_rules.json`

**来源**：《孙伯陵秘传走失神书》

### 概述
- **规则数量**：132条（11个用神 × 12地支）
- **键名格式**：`{星宿名}在{地支}`，如 `觜星在子`、`奎宿在丑`

### 数据结构

```json
"meta": {
  "schema": {
    "text": "原文断语全文",
    "category": "分类标签（人物-男子、动物-马、财物-金帛等）",
    "direction": "方位信息（正北、东北方、西南方等）",
    "distance": "距离信息（九里远、三十里内、百里外等）",
    "environment": "环境/场景（水边、河边、寺边、树林中等）",
    "informant": "报信人（打鱼人、僧人、妇人、铁匠人等）",
    "time_hint": "时间提示（第三日巳时、十日不回、三日内等）"
  }
},
"rules": {
  "觜星在子": {
    "text": "觜星在子，男子穿两色衣物，圆脸、面黑、身短...",
    "category": "人物-男子"
  },
  ...
}
```

### 分类统计

| 分类 | 用神星宿 | 规则数量 |
|------|----------|----------|
| 人物-男子 | 觜 | 12条 |
| 人物-女子 | 奎、女 | 24条 |
| 人物-小儿 | 虚 | 12条 |
| 动物-马 | 星 | 12条 |
| 动物-牛 | 牛 | 12条 |
| 动物-驴骡 | 房 | 12条 |
| 动物-羊 | 鬼 | 12条 |
| 动物-猪 | 室 | 12条 |
| 财物-金帛 | 参 | 12条 |
| 物品-衣服 | 柳 | 12条 |

---

## 5. 演算链路说明

### 走失演禽核心流程

```
用户输入：日期 + 时辰 + 象类（走失对象）
     ↓
1. 日禽计算：日期 → 七元甲子算法 → 日禽（值日星宿）
     ↓
2. 时禽计算：日禽属性 + 时辰 → 时禽
     ↓
3. 用神定位：象类 → 查 lost_items_config.json → 用神星宿
     ↓
4. 落宫计算：(用神索引 - 日禽索引 + 时辰索引) % 12 → 地支
     ↓
5. 断语查询：{用神}在{地支} → 查 lost_items_rules.json → 断语
     ↓
输出：方位、距离、环境、报信人、时间提示
```

---

## 6. 扩展规划

### 6.1 演禽盘式（待实现）

演禽盘式需要同时计算并展示：
- **本禽**（日禽）
- **身禽**（时禽）
- **用禽**（用神）
- **应禽**（翻禽）
- **变禽**（活曜）

### 6.2 禽星锁泊十二宫（待实现）

将计算出的星宿安入十二宫位，判断：
- 生克关系
- 宫位吉凶
- 动静虚实

---

## 7. 开发备注

### 数据来源
- 起年禽诀、起月禽诀、起日禽诀、起时禽诀 → `yanqin_star_rules.json`
- 《鬼谷子二十八宿演禽走失全书歌》 → `lost_items_config.json`
- 《孙伯陵秘传走失神书》/《规则.md》 → `lost_items_rules.json`

### 注意事项
1. **日禽**是演禽术的核心，必须使用七元甲子算法，不能简单用28天循环
2. 所有规则数据外置为 JSON，代码中不硬编码
3. 万年历数据不含值日星宿字段，需通过算法计算

---

